FROM node:20-slim

WORKDIR /app

# Copy package files
COPY package.json package-lock.json* ./

# Install only production dependencies
RUN npm install --production

# Copy server files
COPY api-server.js ./
COPY db.json ./

# Expose the API port
EXPOSE 4000

# Set production environment defaults
ENV NODE_ENV=production
ENV PORT=4000

# Create data directory for persistent storage
RUN mkdir -p /data

# Run the API server
CMD ["node", "api-server.js"]
